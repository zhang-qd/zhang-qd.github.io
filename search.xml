<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>OpenFOAM安装</title>
    <url>/2023/09/12/OpenFOAM%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<blockquote>
<p>2023年9月1日至2023年9月7日在曙光超算上部署多个版本的<code>OpenFOAM</code>，在此记录下安装过程。</p>
</blockquote>
<p>假设软件目录仿照如下方式进行设置（以<code>OpenFOAM-7</code>为例），且以下目录均已存在。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">v7</span><br><span class="line"> |---- app      # 存放可执行文件</span><br><span class="line"> |---- case     # 存放算例文件</span><br><span class="line"> |---- doc      # 存放说明文档</span><br><span class="line"> |---- scripts  # 存放脚本文件</span><br><span class="line"> |---- source   # 存放源代码文件</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="OpenFOAM-7"><a href="#OpenFOAM-7" class="headerlink" title="OpenFOAM-7"></a><code>OpenFOAM-7</code></h2><h3 id="下载源代码"><a href="#下载源代码" class="headerlink" title="下载源代码"></a>下载源代码</h3><p>以下为<code>download.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">cd $SCRIPTDIR/source</span><br><span class="line"></span><br><span class="line">git clone https://github.com/OpenFOAM/OpenFOAM-7.git</span><br><span class="line">git clone https://github.com/OpenFOAM/ThirdParty-7.git</span><br></pre></td></tr></table></figure>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>以下为<code>install.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line">module load compiler/intel/2021.3.0 # intel-2021</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装目录</span></span><br><span class="line">INSTALL_PATH=$SCRIPTDIR</span><br><span class="line">INSTALL_PATH_NEW=$&#123;INSTALL_PATH//\//\\\/&#125;</span><br><span class="line">FOAM_NAME=OpenFOAM-7</span><br><span class="line">THIRD_NAME=ThirdParty-7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入安装目录</span></span><br><span class="line">cd $INSTALL_PATH/app</span><br><span class="line">rm -rf ./*</span><br><span class="line">cp -r ../source/$FOAM_NAME ./</span><br><span class="line">cp -r ../source/$THIRD_NAME ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT=OpenFOAM/export\ MY_INSTALL_PATH=&#x27;$INSTALL_PATH_NEW&#x27;\/app\nexport\ WM_PROJECT=OpenFOAM/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ FOAM_INST_DIR=\$HOME\/\$WM_PROJECT/export\ FOAM_INST_DIR=\$MY_INSTALL_PATH/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT_USER_DIR=\$HOME\/\$WM_PROJECT\/\$USER-\$WM_PROJECT_VERSION/export\ WM_PROJECT_USER_DIR=\$WM_PROJECT_INST_DIR\/\$USER-\$WM_PROJECT_VERSION/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_COMPILER=Gcc/export WM_COMPILER=Icc/&#x27; $FOAM_NAME/etc/bashrc # 使用intel编译器</span><br><span class="line">sed -i &#x27;s/export\ WM_MPLIB=SYSTEMOPENMPI/export\ WM_MPLIB=INTELMPI\nMPI_ROOT=\$I_MPI_ROOT/&#x27; $FOAM_NAME/etc/bashrc # 使用intelMPI</span><br><span class="line">echo &#x27;export WM_CC=icc&#x27; &gt;&gt; $FOAM_NAME/etc/bashrc # 使用intel编译器编译第三方库</span><br><span class="line">echo &#x27;export WM_CXX=icpc&#x27; &gt;&gt; $FOAM_NAME/etc/bashrc # 使用intel编译器编译第三方库</span><br><span class="line">sed -i &#x27;s/gcc/$(WM_CC)/g&#x27; $THIRD_NAME/etc/wmakeFiles/scotch/Makefile.inc.i686_pc_linux2.shlib-OpenFOAM # 使用intel编译器编译scotch</span><br><span class="line">sed -i &#x27;s/mpicc/mpiicc/g&#x27; $THIRD_NAME/etc/wmakeFiles/scotch/Makefile.inc.i686_pc_linux2.shlib-OpenFOAM # 使用intel编译器编译scotch</span><br><span class="line">sed -i &#x27;s/include64/include/g&#x27; $FOAM_NAME/wmake/rules/General/mplibINTELMPI64</span><br><span class="line">sed -i &#x27;s/lib64/lib\/release/g&#x27; $FOAM_NAME/wmake/rules/General/mplibINTELMPI64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $FOAM_NAME/etc/bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译第三方程序</span></span><br><span class="line">cd $THIRD_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.thirdparty-7 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译OpenFOAM</span></span><br><span class="line">cd ../$FOAM_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.openfoam-7 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="加载环境变量"><a href="#加载环境变量" class="headerlink" title="加载环境变量"></a>加载环境变量</h3><p>以下为<code>env.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line">module load compiler/intel/2021.3.0 # intel-2021</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $SCRIPTDIR/app/OpenFOAM-7/etc/bashrc</span><br></pre></td></tr></table></figure>

<h3 id="软件测试"><a href="#软件测试" class="headerlink" title="软件测试"></a>软件测试</h3><p>以下为<code>job.sh</code>脚本内容，该脚本位于<code>case</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -J cavity</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -p xahctar</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -N 2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH --ntasks-per-node=2</span></span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">source ../scripts/env.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝官方自带算例文件</span></span><br><span class="line">rm -rf ./cavity</span><br><span class="line">cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .</span><br><span class="line"></span><br><span class="line">cd cavity</span><br><span class="line">cp $FOAM_ETC/caseDicts/preProcessing/decomposeParDict ./system # 自带算例为串行算例，将其修改为并行算例</span><br><span class="line">sed -i &#x27;s/4/2/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/8/4/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/20/100/g&#x27; system/blockMeshDict # 增大网格分辨率</span><br><span class="line">sed -i &#x27;s/0\.005/0\.00004/g&#x27; system/controlDict # 保证计算稳定</span><br><span class="line">sed -i &#x27;s/20/2500/g&#x27; system/controlDict # 设置输出文件间隔</span><br><span class="line">sed -i &#x27;s/0\.5/1/g&#x27; system/controlDict # 设置计算时间</span><br><span class="line"></span><br><span class="line">blockMesh &gt; log.blockMesh 2&gt;&amp;1 # 划分网格</span><br><span class="line">decomposePar &gt; log.decomposePar 2&gt;&amp;1 # 并行分区</span><br><span class="line">mpirun icoFoam -parallel &gt; log.icoFoam 2&gt;&amp;1 # 开始计算</span><br><span class="line">reconstructPar &gt; log.reconstructPar 2&gt;&amp;1 #将并行计算的数据归纳，便于后处理</span><br></pre></td></tr></table></figure>

<p>在<code>case</code>目录下运行<code>sbatch ./job.sh</code>命令即可提交任务。</p>
<h2 id="OpenFOAM-8"><a href="#OpenFOAM-8" class="headerlink" title="OpenFOAM-8"></a><code>OpenFOAM-8</code></h2><h3 id="下载源代码-1"><a href="#下载源代码-1" class="headerlink" title="下载源代码"></a>下载源代码</h3><p>以下为<code>download.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">cd $SCRIPTDIR/source</span><br><span class="line"></span><br><span class="line">git clone https://github.com/OpenFOAM/OpenFOAM-8.git</span><br><span class="line">git clone https://github.com/OpenFOAM/ThirdParty-8.git</span><br></pre></td></tr></table></figure>

<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>以下为<code>install.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line">module load compiler/intel/2021.3.0 # intel-2021</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装目录</span></span><br><span class="line">INSTALL_PATH=$SCRIPTDIR</span><br><span class="line">INSTALL_PATH_NEW=$&#123;INSTALL_PATH//\//\\\/&#125;</span><br><span class="line">FOAM_NAME=OpenFOAM-8</span><br><span class="line">THIRD_NAME=ThirdParty-8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入安装目录</span></span><br><span class="line">cd $INSTALL_PATH/app</span><br><span class="line">rm -rf ./*</span><br><span class="line">cp -r ../source/$FOAM_NAME ./</span><br><span class="line">cp -r ../source/$THIRD_NAME ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT=OpenFOAM/export\ MY_INSTALL_PATH=&#x27;$INSTALL_PATH_NEW&#x27;\/app\nexport\ WM_PROJECT=OpenFOAM/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ FOAM_INST_DIR=\$HOME\/\$WM_PROJECT/export\ FOAM_INST_DIR=\$MY_INSTALL_PATH/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT_USER_DIR=\$HOME\/\$WM_PROJECT\/\$USER-\$WM_PROJECT_VERSION/export\ WM_PROJECT_USER_DIR=\$WM_PROJECT_INST_DIR\/\$USER-\$WM_PROJECT_VERSION/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_COMPILER=Gcc/export WM_COMPILER=Icc/&#x27; $FOAM_NAME/etc/bashrc # 使用intel编译器</span><br><span class="line">sed -i &#x27;s/export\ WM_MPLIB=SYSTEMOPENMPI/export\ WM_MPLIB=INTELMPI\nMPI_ROOT=\$I_MPI_ROOT/&#x27; $FOAM_NAME/etc/bashrc # 使用intelMPI</span><br><span class="line">echo &#x27;export WM_CC=icc&#x27; &gt;&gt; $FOAM_NAME/etc/bashrc # 使用intel编译器编译第三方库</span><br><span class="line">echo &#x27;export WM_CXX=icpc&#x27; &gt;&gt; $FOAM_NAME/etc/bashrc # 使用intel编译器编译第三方库</span><br><span class="line">sed -i &#x27;s/gcc/$(WM_CC)/g&#x27; $THIRD_NAME/etc/wmakeFiles/scotch/Makefile.inc.i686_pc_linux2.shlib-OpenFOAM # 使用intel编译器编译scotch</span><br><span class="line">sed -i &#x27;s/mpicc/mpiicc/g&#x27; $THIRD_NAME/etc/wmakeFiles/scotch/Makefile.inc.i686_pc_linux2.shlib-OpenFOAM # 使用intel编译器编译scotch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $FOAM_NAME/etc/bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译第三方程序</span></span><br><span class="line">cd $THIRD_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.thirdparty-8 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译OpenFOAM</span></span><br><span class="line">cd ../$FOAM_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.openfoam-8 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="加载环境变量-1"><a href="#加载环境变量-1" class="headerlink" title="加载环境变量"></a>加载环境变量</h3><p>以下为<code>env.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line">module load compiler/intel/2021.3.0 # intel-2021</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $SCRIPTDIR/app/OpenFOAM-8/etc/bashrc</span><br></pre></td></tr></table></figure>

<h3 id="软件测试-1"><a href="#软件测试-1" class="headerlink" title="软件测试"></a>软件测试</h3><p>以下为<code>job.sh</code>脚本内容，该脚本位于<code>case</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -J cavity</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -p xahctar</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -N 2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH --ntasks-per-node=2</span></span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">source ../scripts/env.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝官方自带算例文件</span></span><br><span class="line">rm -rf ./cavity</span><br><span class="line">cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .</span><br><span class="line"></span><br><span class="line">cd cavity</span><br><span class="line">cp $FOAM_ETC/caseDicts/preProcessing/decomposeParDict ./system # 自带算例为串行算例，将其修改为并行算例</span><br><span class="line">sed -i &#x27;s/4/2/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/8/4/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/20/100/g&#x27; system/blockMeshDict # 增大网格分辨率</span><br><span class="line">sed -i &#x27;s/0\.005/0\.00004/g&#x27; system/controlDict # 保证计算稳定</span><br><span class="line">sed -i &#x27;s/20/2500/g&#x27; system/controlDict # 设置输出文件间隔</span><br><span class="line">sed -i &#x27;s/0\.5/1/g&#x27; system/controlDict # 设置计算时间</span><br><span class="line"></span><br><span class="line">blockMesh &gt; log.blockMesh 2&gt;&amp;1 # 划分网格</span><br><span class="line">decomposePar &gt; log.decomposePar 2&gt;&amp;1 # 并行分区</span><br><span class="line">mpirun icoFoam -parallel &gt; log.icoFoam 2&gt;&amp;1 # 开始计算</span><br><span class="line">reconstructPar &gt; log.reconstructPar 2&gt;&amp;1 #将并行计算的数据归纳，便于后处理</span><br></pre></td></tr></table></figure>

<p>在<code>case</code>目录下运行<code>sbatch ./job.sh</code>命令即可提交任务。</p>
<h2 id="OpenFOAM-9"><a href="#OpenFOAM-9" class="headerlink" title="OpenFOAM-9"></a><code>OpenFOAM-9</code></h2><h3 id="下载源代码-2"><a href="#下载源代码-2" class="headerlink" title="下载源代码"></a>下载源代码</h3><p>以下为<code>download.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">cd $SCRIPTDIR/source</span><br><span class="line"></span><br><span class="line">git clone https://github.com/OpenFOAM/OpenFOAM-9.git</span><br><span class="line">git clone https://github.com/OpenFOAM/ThirdParty-9.git</span><br></pre></td></tr></table></figure>

<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><p>以下为<code>install.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于安装时曙光超算上的intel编译器不支持C++14标准，因而采用gcc编译</span></span><br><span class="line">module load compiler/gcc/9.3.0 # 加载gcc</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装目录</span></span><br><span class="line">INSTALL_PATH=$SCRIPTDIR</span><br><span class="line">INSTALL_PATH_NEW=$&#123;INSTALL_PATH//\//\\\/&#125;</span><br><span class="line">FOAM_NAME=OpenFOAM-9</span><br><span class="line">THIRD_NAME=ThirdParty-9</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入安装目录</span></span><br><span class="line">cd $INSTALL_PATH/app</span><br><span class="line">rm -rf ./*</span><br><span class="line">cp -r ../source/$FOAM_NAME ./</span><br><span class="line">cp -r ../source/$THIRD_NAME ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT=OpenFOAM/export\ MY_INSTALL_PATH=&#x27;$INSTALL_PATH_NEW&#x27;\/app\nexport\ WM_PROJECT=OpenFOAM/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ FOAM_INST_DIR=\$HOME\/\$WM_PROJECT/export\ FOAM_INST_DIR=\$MY_INSTALL_PATH/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT_USER_DIR=\$HOME\/\$WM_PROJECT\/\$USER-\$WM_PROJECT_VERSION/export\ WM_PROJECT_USER_DIR=\$WM_PROJECT_INST_DIR\/\$USER-\$WM_PROJECT_VERSION/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_MPLIB=SYSTEMOPENMPI/export\ WM_MPLIB=INTELMPI\nMPI_ROOT=\$I_MPI_ROOT/&#x27; $FOAM_NAME/etc/bashrc # 使用intelMPI</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $FOAM_NAME/etc/bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译第三方程序</span></span><br><span class="line">cd $THIRD_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.thirdparty-9 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译OpenFOAM</span></span><br><span class="line">cd ../$FOAM_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.openfoam-9 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="加载环境变量-2"><a href="#加载环境变量-2" class="headerlink" title="加载环境变量"></a>加载环境变量</h3><p>以下为<code>env.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于安装时曙光超算上的intel编译器不支持C++14标准，因而采用gcc编译</span></span><br><span class="line">module load compiler/gcc/9.3.0 # 加载gcc</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $SCRIPTDIR/app/OpenFOAM-9/etc/bashrc</span><br></pre></td></tr></table></figure>

<h3 id="软件测试-2"><a href="#软件测试-2" class="headerlink" title="软件测试"></a>软件测试</h3><p>以下为<code>job.sh</code>脚本内容，该脚本位于<code>case</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -J cavity</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -p xahctar</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -N 2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH --ntasks-per-node=2</span></span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">source ../scripts/env.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝官方自带算例文件</span></span><br><span class="line">rm -rf ./cavity</span><br><span class="line">cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .</span><br><span class="line"></span><br><span class="line">cd cavity</span><br><span class="line">cp $FOAM_ETC/caseDicts/preProcessing/decomposeParDict ./system # 自带算例为串行算例，将其修改为并行算例</span><br><span class="line">sed -i &#x27;s/4/2/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/8/4/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/20/100/g&#x27; system/blockMeshDict # 增大网格分辨率</span><br><span class="line">sed -i &#x27;s/0\.005/0\.00004/g&#x27; system/controlDict # 保证计算稳定</span><br><span class="line">sed -i &#x27;s/20/2500/g&#x27; system/controlDict # 设置输出文件间隔</span><br><span class="line">sed -i &#x27;s/0\.5/1/g&#x27; system/controlDict # 设置计算时间</span><br><span class="line"></span><br><span class="line">blockMesh &gt; log.blockMesh 2&gt;&amp;1 # 划分网格</span><br><span class="line">decomposePar &gt; log.decomposePar 2&gt;&amp;1 # 并行分区</span><br><span class="line">mpirun icoFoam -parallel &gt; log.icoFoam 2&gt;&amp;1 # 开始计算</span><br><span class="line">reconstructPar &gt; log.reconstructPar 2&gt;&amp;1 #将并行计算的数据归纳，便于后处理</span><br></pre></td></tr></table></figure>

<p>在<code>case</code>目录下运行<code>sbatch ./job.sh</code>命令即可提交任务。</p>
<h2 id="OpenFOAM-10"><a href="#OpenFOAM-10" class="headerlink" title="OpenFOAM-10"></a><code>OpenFOAM-10</code></h2><h3 id="下载源代码-3"><a href="#下载源代码-3" class="headerlink" title="下载源代码"></a>下载源代码</h3><p>以下为<code>download.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">cd $SCRIPTDIR/source</span><br><span class="line"></span><br><span class="line">git clone https://github.com/OpenFOAM/OpenFOAM-10.git</span><br><span class="line">git clone https://github.com/OpenFOAM/ThirdParty-10.git</span><br></pre></td></tr></table></figure>

<h3 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h3><p>以下为<code>install.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于安装时曙光超算上的intel编译器不支持C++14标准，因而采用gcc编译</span></span><br><span class="line">module load compiler/gcc/9.3.0 # 加载gcc</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装目录</span></span><br><span class="line">INSTALL_PATH=$SCRIPTDIR</span><br><span class="line">INSTALL_PATH_NEW=$&#123;INSTALL_PATH//\//\\\/&#125;</span><br><span class="line">FOAM_NAME=OpenFOAM-10</span><br><span class="line">THIRD_NAME=ThirdParty-10</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入安装目录</span></span><br><span class="line">cd $INSTALL_PATH/app</span><br><span class="line">rm -rf ./*</span><br><span class="line">cp -r ../source/$FOAM_NAME ./</span><br><span class="line">cp -r ../source/$THIRD_NAME ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT=OpenFOAM/export\ MY_INSTALL_PATH=&#x27;$INSTALL_PATH_NEW&#x27;\/app\nexport\ WM_PROJECT=OpenFOAM/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ FOAM_INST_DIR=\$HOME\/\$WM_PROJECT/export\ FOAM_INST_DIR=\$MY_INSTALL_PATH/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT_USER_DIR=\$HOME\/\$WM_PROJECT\/\$USER-\$WM_PROJECT_VERSION/export\ WM_PROJECT_USER_DIR=\$WM_PROJECT_INST_DIR\/\$USER-\$WM_PROJECT_VERSION/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_MPLIB=SYSTEMOPENMPI/export\ WM_MPLIB=INTELMPI\nMPI_ROOT=\$I_MPI_ROOT/&#x27; $FOAM_NAME/etc/bashrc # 使用intelMPI</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $FOAM_NAME/etc/bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译第三方程序</span></span><br><span class="line">cd $THIRD_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.thirdparty-10 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译OpenFOAM</span></span><br><span class="line">cd ../$FOAM_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.openfoam-10 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="加载环境变量-3"><a href="#加载环境变量-3" class="headerlink" title="加载环境变量"></a>加载环境变量</h3><p>以下为<code>env.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于安装时曙光超算上的intel编译器不支持C++14标准，因而采用gcc编译</span></span><br><span class="line">module load compiler/gcc/9.3.0 # 加载gcc</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $SCRIPTDIR/app/OpenFOAM-10/etc/bashrc</span><br></pre></td></tr></table></figure>

<h3 id="软件测试-3"><a href="#软件测试-3" class="headerlink" title="软件测试"></a>软件测试</h3><p>以下为<code>job.sh</code>脚本内容，该脚本位于<code>case</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -J cavity</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -p xahctar</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -N 2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH --ntasks-per-node=2</span></span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">source ../scripts/env.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝官方自带算例文件</span></span><br><span class="line">rm -rf ./cavity</span><br><span class="line">cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .</span><br><span class="line"></span><br><span class="line">cd cavity</span><br><span class="line">cp $FOAM_ETC/caseDicts/preProcessing/decomposeParDict ./system # 自带算例为串行算例，将其修改为并行算例</span><br><span class="line">sed -i &#x27;s/4/2/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/8/4/g&#x27; system/decomposeParDict # 设置为4核并行</span><br><span class="line">sed -i &#x27;s/20/100/g&#x27; system/blockMeshDict # 增大网格分辨率</span><br><span class="line">sed -i &#x27;s/0\.005/0\.00004/g&#x27; system/controlDict # 保证计算稳定</span><br><span class="line">sed -i &#x27;s/20/2500/g&#x27; system/controlDict # 设置输出文件间隔</span><br><span class="line">sed -i &#x27;s/0\.5/1/g&#x27; system/controlDict # 设置计算时间</span><br><span class="line"></span><br><span class="line">blockMesh &gt; log.blockMesh 2&gt;&amp;1 # 划分网格</span><br><span class="line">decomposePar &gt; log.decomposePar 2&gt;&amp;1 # 并行分区</span><br><span class="line">mpirun icoFoam -parallel &gt; log.icoFoam 2&gt;&amp;1 # 开始计算</span><br><span class="line">reconstructPar &gt; log.reconstructPar 2&gt;&amp;1 #将并行计算的数据归纳，便于后处理</span><br></pre></td></tr></table></figure>

<p>在<code>case</code>目录下运行<code>sbatch ./job.sh</code>命令即可提交任务。</p>
<h2 id="OpenFOAM-11"><a href="#OpenFOAM-11" class="headerlink" title="OpenFOAM-11"></a><code>OpenFOAM-11</code></h2><h3 id="下载源代码-4"><a href="#下载源代码-4" class="headerlink" title="下载源代码"></a>下载源代码</h3><p>以下为<code>download.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">cd $SCRIPTDIR/source</span><br><span class="line"></span><br><span class="line">git clone https://github.com/OpenFOAM/OpenFOAM-11.git</span><br><span class="line">git clone https://github.com/OpenFOAM/ThirdParty-11.git</span><br></pre></td></tr></table></figure>

<h3 id="安装-4"><a href="#安装-4" class="headerlink" title="安装"></a>安装</h3><p>以下为<code>install.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module purge # 卸载之前的环境</span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line">module load compiler/gcc/9.3.0 # 加载gcc</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装目录</span></span><br><span class="line">INSTALL_PATH=$SCRIPTDIR</span><br><span class="line">INSTALL_PATH_NEW=$&#123;INSTALL_PATH//\//\\\/&#125;</span><br><span class="line">FOAM_NAME=OpenFOAM-11</span><br><span class="line">THIRD_NAME=ThirdParty-11</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入安装目录</span></span><br><span class="line">cd $INSTALL_PATH/app</span><br><span class="line">rm -rf ./*</span><br><span class="line">cp -r ../source/$FOAM_NAME ./</span><br><span class="line">cp -r ../source/$THIRD_NAME ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT=OpenFOAM/export\ MY_INSTALL_PATH=&#x27;$INSTALL_PATH_NEW&#x27;\/app\nexport\ WM_PROJECT=OpenFOAM/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ FOAM_INST_DIR=\$HOME\/\$WM_PROJECT/export\ FOAM_INST_DIR=\$MY_INSTALL_PATH/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT_USER_DIR=\$HOME\/\$WM_PROJECT\/\$USER-\$WM_PROJECT_VERSION/export\ WM_PROJECT_USER_DIR=\$WM_PROJECT_INST_DIR\/\$USER-\$WM_PROJECT_VERSION/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/export\ WM_MPLIB=SYSTEMOPENMPI/export\ WM_MPLIB=INTELMPI\nMPI_ROOT=\$I_MPI_ROOT/&#x27; $FOAM_NAME/etc/bashrc # 使用intelMPI</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $FOAM_NAME/etc/bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译第三方程序</span></span><br><span class="line">cd $THIRD_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.thirdparty-11 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译OpenFOAM</span></span><br><span class="line">cd ../$FOAM_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.openfoam-11 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="加载环境变量-4"><a href="#加载环境变量-4" class="headerlink" title="加载环境变量"></a>加载环境变量</h3><p>以下为<code>env.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line">module load compiler/gcc/9.3.0 # 加载gcc</span><br><span class="line">module load mpi/intelmpi/2021.3.0 # intel-2021</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $SCRIPTDIR/app/OpenFOAM-11/etc/bashrc</span><br></pre></td></tr></table></figure>

<h3 id="软件测试-4"><a href="#软件测试-4" class="headerlink" title="软件测试"></a>软件测试</h3><p>以下为<code>job.sh</code>脚本内容，该脚本位于<code>case</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -J NACA0012</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -p xahctar</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -N 2</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH --ntasks-per-node=2</span></span><br><span class="line"> </span><br><span class="line">module purge # 卸载之前的环境 </span><br><span class="line">source ../scripts/env.sh </span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝官方自带算例文件</span> </span><br><span class="line">rm -rf ./aerofoilNACA0012Steady </span><br><span class="line">cp -r $FOAM_TUTORIALS/fluid/aerofoilNACA0012Steady . </span><br><span class="line">cd aerofoilNACA0012Steady </span><br><span class="line">cp $FOAM_ETC/caseDicts/preProcessing/decomposeParDict ./system/ </span><br><span class="line">sed -i &#x27;s/8/4/g&#x27; ./system/decomposeParDict </span><br><span class="line">sed -i &#x27;s/4\ 2\ 1/2\ 1\ 2/g&#x27; ./system/decomposeParDict </span><br><span class="line">sed -i &#x27;s/nNonOrthogonalCorrectors\ 0/nNonOrthogonalCorrectors\ 2/g&#x27; ./system/fvSolution </span><br><span class="line"></span><br><span class="line">cp $FOAM_TUTORIALS/resources/geometry/NACA0012.obj.gz constant/geometry/ </span><br><span class="line"> </span><br><span class="line">blockMesh &gt; log.blockMesh 2&gt;&amp;1 </span><br><span class="line">transformPoints &quot;scale=(1 0 1)&quot; &gt; log.transformPoints 2&gt;&amp;1 </span><br><span class="line">extrudeMesh &gt; log.extrudeMesh 2&gt;&amp;1 </span><br><span class="line">decomposePar &gt; log.decomposePar 2&gt;&amp;1 </span><br><span class="line">mpirun foamRun -parallel &gt; log.foamRun 2&gt;&amp;1 </span><br><span class="line">reconstructPar &gt; log.reconstructPar 2&gt;&amp;1 </span><br></pre></td></tr></table></figure>

<p>在<code>case</code>目录下运行<code>sbatch ./job.sh</code>命令即可提交任务。</p>
<h2 id="OpenFOAM-v1812"><a href="#OpenFOAM-v1812" class="headerlink" title="OpenFOAM-v1812"></a><code>OpenFOAM-v1812</code></h2><h3 id="下载源代码-5"><a href="#下载源代码-5" class="headerlink" title="下载源代码"></a>下载源代码</h3><p>以下为<code>download.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">cd $SCRIPTDIR/source</span><br><span class="line">wget https://sourceforge.net/projects/openfoam/files/v1812/OpenFOAM-v1812.tgz</span><br><span class="line">wget https://sourceforge.net/projects/openfoam/files/v1812/ThirdParty-v1812.tgz</span><br><span class="line">tar -zxf OpenFOAM-v1812.tgz</span><br><span class="line">tar -zxf ThirdParty-v1812.tgz</span><br><span class="line">rm -rf OpenFOAM-v1812.tgz ThirdParty-v1812.tgz</span><br></pre></td></tr></table></figure>

<h3 id="安装-5"><a href="#安装-5" class="headerlink" title="安装"></a>安装</h3><p>以下为<code>install.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载cmake环境</span></span><br><span class="line">module load compiler/cmake/3.23.3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装目录所需环境变量</span></span><br><span class="line">INSTALL_PATH=$SCRIPTDIR</span><br><span class="line">INSTALL_PATH_NEW=$&#123;INSTALL_PATH//\//\\\/&#125;</span><br><span class="line">FOAM_NAME=OpenFOAM-v1812</span><br><span class="line">THIRD_NAME=ThirdParty-v1812</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入安装目录</span></span><br><span class="line">cd $INSTALL_PATH/app</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝源代码至安装目录</span></span><br><span class="line">rm -rf ./*</span><br><span class="line">cp -r ../source/$FOAM_NAME ./</span><br><span class="line">cp -r ../source/$THIRD_NAME ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改etc/bashrc文件</span></span><br><span class="line">sed -i &#x27;s/export\ WM_PROJECT=OpenFOAM/export\ MY_INSTALL_PATH=&#x27;$INSTALL_PATH_NEW&#x27;\/app\nexport\ WM_PROJECT=OpenFOAM/&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/HOME\/OpenFOAM/MY_INSTALL_PATH/g&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line">sed -i &#x27;s/HOME\/\$WM_PROJECT/MY_INSTALL_PATH/g&#x27; $FOAM_NAME/etc/bashrc # 更改安装路径</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $FOAM_NAME/etc/bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译第三方程序</span></span><br><span class="line">cd $THIRD_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.thirdparty-v1812 2&gt;&amp;1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译OpenFOAM</span></span><br><span class="line">cd ../$FOAM_NAME</span><br><span class="line">./Allwmake -j 24 &gt; ../log.openfoam-v1812 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="加载环境变量-5"><a href="#加载环境变量-5" class="headerlink" title="加载环境变量"></a>加载环境变量</h3><p>以下为<code>env.sh</code>脚本内容，该脚本位于<code>scripts</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SCRIPTDIR=$(cd $(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;) &gt;/dev/null &amp;&amp; cd .. &amp;&amp; pwd)</span><br><span class="line"></span><br><span class="line">module load compiler/cmake/3.23.3 # 加载cmake</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载环境变量</span></span><br><span class="line">source $SCRIPTDIR/app/OpenFOAM-v1812/etc/bashrc</span><br></pre></td></tr></table></figure>

<h3 id="软件测试-5"><a href="#软件测试-5" class="headerlink" title="软件测试"></a>软件测试</h3><p>以下为<code>job.sh</code>脚本内容，该脚本位于<code>case</code>文件夹下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -J cavity</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -p xahctar</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH -N 2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SBATCH --ntasks-per-node=2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统默认环境，无需purge</span></span><br><span class="line">source ../scripts/env.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝官方自带算例文件</span></span><br><span class="line">rm -rf ./cavity</span><br><span class="line">cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .</span><br><span class="line"></span><br><span class="line">cd cavity</span><br><span class="line">cp $FOAM_TUTORIALS/incompressible/icoFoam/cavityMappingTest/system/coarseMesh/decomposeParDict ./system # 自带算例为串行算例，将其修改为并行算例</span><br><span class="line">sed -i &#x27;s/20/100/g&#x27; system/blockMeshDict # 增大网格分辨率</span><br><span class="line">sed -i &#x27;s/0\.005/0\.00002/g&#x27; system/controlDict # 保证计算稳定</span><br><span class="line">sed -i &#x27;s/20/5000/g&#x27; system/controlDict # 设置输出文件间隔</span><br><span class="line">sed -i &#x27;s/0\.5/1/g&#x27; system/controlDict # 设置计算时间</span><br><span class="line"></span><br><span class="line">blockMesh &gt; log.blockMesh 2&gt;&amp;1 # 划分网格</span><br><span class="line">decomposePar &gt; log.decomposePar 2&gt;&amp;1 # 并行分区</span><br><span class="line">mpirun icoFoam -parallel &gt; log.icoFoam 2&gt;&amp;1 # 开始计算</span><br><span class="line">reconstructPar &gt; log.reconstructPar 2&gt;&amp;1 #将并行计算的数据归纳，便于后处理</span><br></pre></td></tr></table></figure>

<p>在<code>case</code>目录下运行<code>sbatch ./job.sh</code>命令即可提交任务。</p>
]]></content>
      <categories>
        <category>软件安装</category>
      </categories>
      <tags>
        <tag>OpenFOAM</tag>
      </tags>
  </entry>
</search>
